<?php
session_start();
// Exemplo: $_SESSION['nome'] = 'Gabriel'; // remova esta linha no ambiente real
// OBS: no seu sistema real a sess√£o deve ser preenchida ao logar o usu√°rio
$user = $_SESSION['nome'] ?? null;
?>
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>F√°brica de Picol√©s - Sabores para Todos os Gostos</title>

    <!-- Fonts (mantive as suas) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Suas vari√°veis e estilos originais (copiados e mantidos) -->
    <style>
    /* ===== VARI√ÅVEIS CSS ===== */
    :root {
        --primary-color: #ed1c24;
        --primary-dark: #c41820;
        --secondary-color: #ffd700;
        --accent-color: #ff6b9d;
        --text-dark: #1a1a1a;
        --text-light: #666666;
        --bg-light: #f8f9fa;
        --bg-white: #ffffff;
        --border-color: #e0e0e0;
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
        --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.12);
        --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.15);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* ===== RESET E ESTILOS BASE ===== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
        font-family: 'Quicksand', sans-serif;
        color: var(--text-dark);
        background-color: var(--bg-white);
        line-height: 1.6;
        overflow-x: hidden;
    }

    /* ===== CONTAINER ===== */
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

    /* ===== PART√çCULAS DE FUNDO (placeholder) ===== */
    .particles-bg {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(135deg, #fff9f0 0%, #fff5e6 50%, #fffaed 100%);
        z-index: -1; pointer-events: none;
    }
    .particles-bg::before {
        content: ''; position: absolute; width: 100%; height: 100%;
        background-image:
            radial-gradient(circle at 20% 50%, rgba(237, 28, 36, 0.05) 0%, transparent 70%),
            radial-gradient(circle at 80% 80%, rgba(255, 107, 157, 0.05) 0%, transparent 70%);
        animation: float 20s ease-in-out infinite;
    }
    @keyframes float { 0%,100%{transform:translateY(0)}50%{transform:translateY(20px)} }

    /* ===== CABE√áALHO ===== */
    .header {
        position: sticky; top: 0; z-index: 100;
        background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border-color); box-shadow: var(--shadow-sm);
    }
    .header-container {
        max-width: 1200px; margin: 0 auto; padding: 0 20px;
        display: flex; justify-content: space-between; align-items: center; height: 70px;
    }
    .header-left { display:flex; align-items:center; gap: 40px; }
    .logo { display:flex; align-items:center; gap:10px; font-size:24px; font-weight:700; color:var(--primary-color); text-decoration:none; transition:var(--transition); }
    .logo:hover { transform: scale(1.05); }
    .logo-icon { font-size:32px; animation:bounce 2s ease-in-out infinite; }
    @keyframes bounce { 0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)} }
    .logo-text { font-family:'Poppins',sans-serif; background:linear-gradient(135deg,var(--primary-color),var(--accent-color)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }

    .nav { display:flex; gap:30px; }
    .nav-link { color:var(--text-light); text-decoration:none; font-weight:500; transition:var(--transition); position:relative; }
    .nav-link::after { content:''; position:absolute; bottom:-5px; left:0; width:0; height:2px; background:var(--primary-color); transition:var(--transition); }
    .nav-link:hover { color:var(--primary-color); }
    .nav-link:hover::after { width:100%; }

    .header-right { display:flex; align-items:center; gap:20px; }
    .language-selector { display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:20px; background:var(--bg-light); color:var(--text-dark); font-weight:600; cursor:pointer; transition:var(--transition); }
    .language-selector:hover { background:var(--primary-color); color:white; }
    .language-selector svg { width:16px; height:16px; }

    /* ===== BOT√ïES ===== */
    .btn { display:inline-flex; align-items:center; justify-content:center; padding:12px 24px; border-radius:25px; font-weight:600; font-size:14px; text-decoration:none; border:none; cursor:pointer; transition:var(--transition); font-family:'Quicksand',sans-serif; }
    .btn-primary { background: linear-gradient(135deg,var(--primary-color),var(--accent-color)); color:white; box-shadow:var(--shadow-md); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow:var(--shadow-lg); }
    .btn-outline { border:2px solid var(--text-dark); color:var(--text-dark); background:transparent; }
    .btn-large { padding:15px 40px; font-size:16px; }

    /* ===== SE√á√ÉO HERO ===== */
    .hero { min-height: calc(100vh - 70px); display:flex; align-items:center; padding:60px 20px; position:relative; overflow:hidden; }
    .hero::before { content:''; position:absolute; top:-50%; right:-10%; width:600px; height:600px; background:radial-gradient(circle, rgba(237,28,36,0.1) 0%, transparent 70%); border-radius:50%; animation:rotate 20s linear infinite; }
    @keyframes rotate { 0%{transform:rotate(0)}100%{transform:rotate(360deg)} }
    .hero-content { max-width:1200px; margin:0 auto; display:grid; grid-template-columns:1fr 1fr; gap:60px; align-items:center; position:relative; z-index:1; }
    .hero-text { display:flex; flex-direction:column; gap:20px; }
    .hero-subtitle { font-size:16px; color:var(--primary-color); font-weight:700; display:flex; align-items:center; gap:8px; }
    .hero-subtitle::before { content:'‚ú®'; font-size:20px; }
    .hero-title { font-family:'Poppins',sans-serif; font-size:64px; font-weight:800; line-height:1.2; color:var(--text-dark); animation:slideInUp 0.8s ease-out; }
    @keyframes slideInUp { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }
    .hero-description { font-size:16px; color:var(--text-light); line-height:1.8; animation:slideInUp 0.8s ease-out 0.2s both; }
    .hero-image { position:relative; animation:slideInRight 0.8s ease-out 0.4s both; }
    @keyframes slideInRight { from{opacity:0;transform:translateX(50px)} to{opacity:1;transform:translateX(0)} }
    .hero-img { width:100%; height:auto; border-radius:20px; box-shadow:var(--shadow-lg); transition:var(--transition); }
    .hero-img:hover { transform:scale(1.05); }

    /* ===== SE√á√ÉO SOBRE ===== */
    .about { padding:100px 20px; background:var(--bg-light); }
    .section-title { font-family:'Poppins',sans-serif; font-size:48px; font-weight:800; text-align:center; margin-bottom:60px; color:var(--text-dark); }
    .about-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:30px; }
    .about-card { background:white; padding:40px 30px; border-radius:15px; text-align:center; box-shadow:var(--shadow-sm); transition:var(--transition); animation:fadeInUp 0.6s ease-out; }
    @keyframes fadeInUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
    .about-card:hover { transform:translateY(-10px); box-shadow:var(--shadow-lg); }
    .about-icon { font-size:48px; margin-bottom:15px; display:inline-block; }
    .about-card h3 { font-family:'Poppins',sans-serif; font-size:24px; margin-bottom:15px; color:var(--text-dark); }
    .about-card p { color:var(--text-light); line-height:1.8; }

    /* ===== SE√á√ÉO PRODUTOS ===== */
    .products { padding:100px 20px; background:white; }
    .products-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:40px; }
    .product-card { background:white; border-radius:15px; overflow:hidden; box-shadow:var(--shadow-sm); transition:var(--transition); animation:fadeInUp 0.6s ease-out; position:relative; }
    .product-card:hover { transform:translateY(-15px); box-shadow:var(--shadow-lg); }
    .product-image { width:100%; height:250px; overflow:hidden; background:var(--bg-light); }
    .product-image img { width:100%; height:100%; object-fit:cover; transition:var(--transition); }
    .product-card:hover .product-image img { transform:scale(1.1); }
    .product-card h3 { font-family:'Poppins',sans-serif; font-size:22px; padding:20px 20px 10px; color:var(--text-dark); }
    .product-card p { padding:0 20px 20px; color:var(--text-light); line-height:1.8; }

    /* ===== SE√á√ÉO CONTATO ===== */
    .contact { padding:100px 20px; background: linear-gradient(135deg, #fff9f0 0%, #fff5e6 100%); }
    .contact-content { display:grid; grid-template-columns:1fr 1fr; gap:60px; margin-top:60px; }
    .contact-info { display:flex; flex-direction:column; gap:30px; }
    .contact-item { display:flex; gap:20px; animation:fadeInUp 0.6s ease-out; }
    .contact-icon { font-size:32px; min-width:50px; text-align:center; }
    .contact-item h4 { font-family:'Poppins',sans-serif; font-size:18px; margin-bottom:5px; color:var(--text-dark); }
    .contact-item p { color:var(--text-light); }
    .contact-form { display:flex; flex-direction:column; gap:20px; animation:fadeInUp 0.6s ease-out 0.1s both; }
    .contact-form input, .contact-form textarea { padding:15px 20px; border:2px solid var(--border-color); border-radius:10px; font-family:'Quicksand',sans-serif; font-size:14px; transition:var(--transition); }
    .contact-form input:focus, .contact-form textarea:focus { outline:none; border-color:var(--primary-color); box-shadow:0 0 0 3px rgba(237,28,36,0.1); }

    /* ===== RODAP√â ===== */
    .footer { background:var(--text-dark); color:white; padding:40px 20px; text-align:center; }
    .footer .container { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:20px; }
    .social-links { display:flex; gap:20px; }
    .social-link { color:white; text-decoration:none; transition:var(--transition); }
    .social-link:hover { color:var(--primary-color); }

    /* ===== RESPONSIVIDADE ===== */
    @media (max-width: 768px) {
        .hero-content { grid-template-columns:1fr; gap:40px; }
        .hero-title { font-size:42px; }
        .contact-content { grid-template-columns:1fr; gap:40px; }
        .footer .container { flex-direction:column; }
        .btn-large { width:100%; }
    }
    @media (max-width:480px) {
        .header-left { flex-direction:column; gap:15px; }
        .nav { flex-direction:column; gap:10px; }
        .logo-text { display:none; }
        .hero-title { font-size:32px; }
        .hero-subtitle { font-size:14px; }
        .section-title { font-size:28px; }
        .btn { width:100%; }
    }

    /* ===== SCROLL ANIMATIONS ===== */
    .scroll-animate { opacity:0; transform:translateY(20px); transition:var(--transition); }
    .scroll-animate.visible { opacity:1; transform:translateY(0); }

    /* ===== NOVOS ESTILOS DO CARRINHO E INTERA√á√ïES ===== */
    /* botao flutuante do carrinho */
    .cart-fab {
        position: fixed;
        right: 22px;
        bottom: 22px;
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: linear-gradient(135deg,var(--primary-color),var(--accent-color));
        display:flex; align-items:center; justify-content:center;
        color:white; font-size:20px; box-shadow: var(--shadow-lg);
        cursor:pointer; z-index:200;
        transition: transform 0.18s ease, box-shadow 0.18s ease;
    }
    .cart-fab:hover { transform: translateY(-6px); }
    .cart-badge {
        position:absolute; right:-6px; top:-6px; background:#111; color:#fff; padding:4px 7px; border-radius:999px; font-size:12px; border:2px solid #fff;
    }

    /* painel lateral */
    .cart-panel {
        position: fixed; right: 0; top: 0; height: 100%; width: 380px; max-width: 95%;
        background: #fff; box-shadow: -8px 0 32px rgba(0,0,0,0.12); z-index: 250; transform: translateX(110%);
        transition: transform 0.32s cubic-bezier(.2,.9,.2,1);
        display:flex; flex-direction:column; padding:20px;
    }
    .cart-panel.open { transform: translateX(0); }
    .cart-panel h3 { color: var(--text-dark); margin-bottom:12px; }
    .cart-items { flex:1; overflow:auto; display:flex; flex-direction:column; gap:12px; }
    .cart-item {
        display:flex; gap:12px; align-items:center; background:#fafafa; padding:10px; border-radius:10px; border:1px solid var(--border-color);
    }
    .cart-item img { width:76px; height:56px; object-fit:cover; border-radius:8px; }
    .cart-item .meta { flex:1; }
    .cart-item .meta h4 { font-size:16px; color:var(--text-dark); margin-bottom:6px; }
    .qty-control { display:flex; gap:8px; align-items:center; }
    .qty-btn { background:var(--primary-color); color:#fff; border:none; padding:6px 8px; border-radius:6px; cursor:pointer; }
    .remove-link { color:var(--primary-dark); cursor:pointer; font-size:13px; }

    .cart-summary { margin-top:12px; border-top:1px dashed var(--border-color); padding-top:12px; }
    .cart-summary .total { font-size:18px; font-weight:700; color:var(--text-dark); }
    .cart-checkout { margin-top:10px; display:flex; gap:8px; }

    /* greeting user */
    .user-greet { display:flex; align-items:center; gap:10px; font-weight:600; color:var(--text-dark); }
    .user-greet .avatar { width:36px; height:36px; border-radius:50%; background:var(--primary-color); color:#fff; display:flex; align-items:center; justify-content:center; font-weight:700; }
    </style>
</head>
<body>

    <div id="particles-bg" class="particles-bg"></div>

    <!-- CABE√áALHO (mantive estrutura) -->
    <header class="header">
        <div class="header-container container">
            <div class="header-left">
                <a href="#home" class="logo">
                    <span class="logo-icon">üç¶</span>
                    <span class="logo-text">F√°brica de Picol√©s</span>
                </a>

                <nav class="nav">
                    <a href="#home" class="nav-link">Home</a>
                    <a href="#sobre" class="nav-link">Sobre</a>
                    <a href="#produtos" class="nav-link">Produtos</a>
                    <a href="#contato" class="nav-link">Contato</a>
                </nav>
            </div>

            <div class="header-right">
                <div class="language-selector" title="Idioma">
                    <!-- Corrigido: Adicionado 'fill="currentColor"' para que o SVG herde a cor do pai -->
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a10 10 0 100 20 10 10 0 000-20z" fill="currentColor"/></svg>
                    <span>PT</span>
                </div>

                <!-- Aqui mostramos o nome do usu√°rio a partir da sess√£o PHP -->
                <?php if ($user): ?>
                    <div class="user-greet" title="Minha conta">
                        <div class="avatar"><?= htmlspecialchars(mb_substr($user,0,1)) ?></div>
                        <div>
                            Ol√°, <strong><?= htmlspecialchars($user) ?></strong>
                        </div>
                    </div>
                <?php else: ?>
                    <a href="criar_conta.html" class="btn btn-outline">Cadastro</a>
                    <a href="cadastro.html" class="btn btn-primary">Login</a>
                <?php endif; ?>
            </div>
        </div>
    </header>

    <!-- HERO -->
    <section id="home" class="hero">
        <div class="hero-content container">
            <div class="hero-text">
                <span class="hero-subtitle">Ol√°! √â bom ter voc√™ aqui</span>
                <h1 class="hero-title">Sabores para<br>todos os gostos</h1>
                <p class="hero-description">Transformamos momentos em sabores: Nossos picol√©s e sorvetes s√£o a alegria que derrete na boca e aquece o cora√ß√£o.</p>
                <a href="#produtos" class="btn btn-primary btn-large">Ver os Produtos</a>
            </div>
            <div class="hero-image">
                <!-- Corrigido: 'asstes' para 'assets' -->
                <img src="/assets/360_F_117514235_xd5yjVNmhTynk4TskiVpnJN5YAyScQAQ.jpg" alt="Foto hero" class="hero-img">
            </div>
        </div>
    </section>

    <!-- SOBRE -->
    <section id="sobre" class="about">
        <div class="container">
            <h2 class="section-title">Sobre Nossa F√°brica</h2>
            <div class="about-grid">
                <div class="about-card">
                    <div class="about-icon">üé®</div>
                    <h3>Criatividade</h3>
                    <p>Desenvolvemos sabores √∫nicos e inovadores que surpreendem o paladar de todos.</p>
                </div>
                <div class="about-card">
                    <div class="about-icon">‚ú®</div>
                    <h3>Qualidade</h3>
                    <p>Utilizamos apenas ingredientes premium para garantir o melhor sabor e textura.</p>
                </div>
                <div class="about-card">
                    <div class="about-icon">üå±</div>
                    <h3>Sustentabilidade</h3>
                    <p>Comprometidos com pr√°ticas ecol√≥gicas e respons√°veis em toda produ√ß√£o.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- PRODUTOS (agora com bot√£o de adicionar ao carrinho em cada card) -->
    <section id="produtos" class="products">
        <div class="container">
            <h2 class="section-title">Nossos Produtos</h2>
            <div class="products-grid">
                <!-- Product 1 -->
                <div class="product-card" data-name="Picol√© Morango" data-price="4.00" data-img="/assets/popsicle-collection.jpg">
                    <div class="product-image">
                        <!-- Corrigido: Adicionado '/assets/' ao caminho da imagem -->
                        <img src="/assets/popsicle-collection.jpg" alt="Cole√ß√£o de picol√©s">
                    </div>
                    <h3>Cl√°ssicos</h3>
                    <p>Os sabores tradicionais que todos amam: morango, chocolate, lim√£o e muito mais.</p>
                    <div style="padding:0 20px 20px;">
                        <button class="btn btn-primary add-to-cart">Adicionar ao Carrinho - R$ 4,00</button>
                    </div>
                </div>

                <!-- Product 2 -->
                <div class="product-card" data-name="Picol√© Manga" data-price="5.50" data-img="/assets/summer-fun.jpg">
                    <div class="product-image">
                        <!-- Corrigido: Adicionado '/assets/' ao caminho da imagem -->
                        <img src="/assets/summer-fun.jpg" alt="Picol√©s de ver√£o">
                    </div>
                    <h3>Tropicais</h3>
                    <p>Sabores ex√≥ticos com frutas tropicais: manga, maracuj√°, coco e abacaxi.</p>
                    <div style="padding:0 20px 20px;">
                        <button class="btn btn-primary add-to-cart">Adicionar ao Carrinho - R$ 5,50</button>
                    </div>
                </div>

                <!-- Product 3 -->
                <div class="product-card" data-name="Picol√© Premium" data-price="7.90" data-img="/assets/popsicle-close-up.jpg">
                    <div class="product-image">
                        <!-- Corrigido: Adicionado '/assets/' ao caminho da imagem -->
                        <img src="/assets/popsicle-close-up.jpg" alt="Picol√© em close">
                    </div>
                    <h3>Premium</h3>
                    <p>Edi√ß√µes limitadas com ingredientes especiais e sabores sofisticados.</p>
                    <div style="padding:0 20px 20px;">
                        <button class="btn btn-primary add-to-cart">Adicionar ao Carrinho - R$ 7,90</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CONTATO -->
    <section id="contato" class="contact">
        <div class="container">
            <h2 class="section-title">Entre em Contato</h2>
            <div class="contact-content">
                <div class="contact-info">
                    <div class="contact-item">
                        <span class="contact-icon">üìç</span>
                        <div>
                            <h4>Endere√ßo</h4>
                            <p>Rua dos Picol√©s, 123 - S√£o Paulo, SP</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <span class="contact-icon">üìû</span>
                        <div>
                            <h4>Telefone</h4>
                            <p>(11) 9999-9999</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <span class="contact-icon">‚úâÔ∏è</span>
                        <div>
                            <h4>Email</h4>
                            <p>contato@fabricapicoles.com</p>
                        </div>
                    </div>
                </div>
                <form class="contact-form" id="contactForm">
                    <input type="text" placeholder="Seu nome" required>
                    <input type="email" placeholder="Seu email" required>
                    <textarea placeholder="Sua mensagem" rows="5" required></textarea>
                    <button type="submit" class="btn btn-primary">Enviar Mensagem</button>
                </form>
            </div>
        </div>
    </section>

    <!-- RODAP√â -->
    <footer class="footer">
        <div class="container">
            <p>&copy; <?= date('Y') ?> F√°brica de Picol√©s. Todos os direitos reservados.</p>
            <div class="social-links">
                <a href="#" class="social-link">Facebook</a>
                <a href="#" class="social-link">Instagram</a>
                <a href="#" class="social-link">Twitter</a>
            </div>
        </div>
    </footer>

    <!-- FAB Carrinho -->
    <div class="cart-fab" id="cartFab" title="Abrir carrinho">
        üõí
        <div class="cart-badge" id="cartCount">0</div>
    </div>

    <!-- Painel do Carrinho -->
    <aside class="cart-panel" id="cartPanel" aria-hidden="true">
        <h3>Seu Carrinho</h3>
        <div class="cart-items" id="cartItems">
            <!-- itens renderizados pelo JS -->
        </div>
        <div class="cart-summary">
            <div class="total">Total: R$ <span id="cartTotal">0.00</span></div>
            <div class="cart-checkout">
                <button class="btn btn-primary" id="checkoutBtn">Finalizar Compra</button>
                <button class="btn btn-outline" id="closeCartBtn">Fechar</button>
            </div>
        </div>
    </aside>

    <!-- Scripts: n√£o removi o particles/main que voc√™ tinha; mas o carrinho √© independente -->
    <script>
    /* ===== L√ìGICA DO CARRINHO (front-end) =====
       - persiste em localStorage
       - atualiza contador no FAB
       - permite alterar quantidade e remover
       - envia dados ao finalizar (ex: fetch para finalizar_compra.php)
    */

    (function(){
        // elementos
        const cartFab = document.getElementById('cartFab');
        const cartPanel = document.getElementById('cartPanel');
        const cartItemsEl = document.getElementById('cartItems');
        const cartCountEl = document.getElementById('cartCount');
        const cartTotalEl = document.getElementById('cartTotal');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const closeCartBtn = document.getElementById('closeCartBtn');

        // estado do carrinho (persistido)
        const STORAGE_KEY = 'loja_picoles_cart_v1';
        let cart = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

        // helpers
        function saveCart(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(cart)); renderCart(); }
        // Corrigido: Adicionado toLocaleString para formata√ß√£o correta de moeda BRL
        function formatBRL(v){ return v.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); }
        function calcTotal(){ return cart.reduce((s,i) => s + (i.price * i.qty), 0); }
        function updateBadge(){ cartCountEl.textContent = cart.reduce((s,i)=>s+i.qty,0) }

        // render do painel
        function renderCart(){
            cartItemsEl.innerHTML = '';
            if(cart.length === 0){
                cartItemsEl.innerHTML = '<div style="color:var(--text-light);padding:12px">Seu carrinho est√° vazio.</div>';
            } else {
                cart.forEach((item, idx) => {
                    const div = document.createElement('div');
                    div.className = 'cart-item';
                    div.innerHTML = `
                        <img src="${item.img}" alt="${item.name}">
                        <div class="meta">
                            <h4>${item.name}</h4>
                            <div style="display:flex;gap:12px;align-items:center;margin-top:6px">
                                <div class="qty-control">
                                    <button class="qty-btn" data-idx="${idx}" data-action="dec">-</button>
                                    <div style="padding:0 8px">${item.qty}</div>
                                    <button class="qty-btn" data-idx="${idx}" data-action="inc">+</button>
                                </div>
                                <!-- Corrigido: Usando formatBRL para exibir o pre√ßo unit√°rio -->
                                <div style="margin-left:8px;color:var(--text-light)">R$ ${formatBRL(item.price)}</div>
                                <div style="margin-left:auto"><span class="remove-link" data-idx="${idx}">Remover</span></div>
                            </div>
                        </div>
                    `;
                    cartItemsEl.appendChild(div);
                });
            }

            // attach events (delegation is simpler, but here we add per element)
            // Corrigido: Usando event delegation no cartItemsEl para bot√µes de quantidade e remover
            cartItemsEl.addEventListener('click', (e) => {
                const target = e.target;
                const isQtyBtn = target.classList.contains('qty-btn');
                const isRemoveLink = target.classList.contains('remove-link');

                if (isQtyBtn || isRemoveLink) {
                    const idx = Number(target.dataset.idx);

                    if (isQtyBtn) {
                        const action = target.dataset.action;
                        if(action === 'inc'){ cart[idx].qty += 1; }
                        if(action === 'dec'){ cart[idx].qty = Math.max(1, cart[idx].qty - 1); }
                    } else if (isRemoveLink) {
                        cart.splice(idx, 1);
                    }
                    saveCart();
                }
            });

            // Corrigido: Chamada de renderCart() para evitar duplica√ß√£o de listeners
            // cartItemsEl.querySelectorAll('.qty-btn').forEach(btn=>{...});
            // cartItemsEl.querySelectorAll('.remove-link').forEach(link=>{...});

            cartTotalEl.textContent = formatBRL(calcTotal());
            updateBadge();
        }

        // adicionar item (usado pelos bot√µes em product-card)
        function addToCart(data){
            // se j√° existir, incrementa qty
            // Corrigido: Compara√ß√£o de pre√ßo como string para evitar problemas de ponto flutuante no findIndex
            const idx = cart.findIndex(i => i.name === data.name && i.price.toFixed(2) === data.price.toFixed(2));
            if(idx >= 0){
                cart[idx].qty += 1;
            } else {
                cart.push({ name: data.name, price: data.price, qty: 1, img: data.img });
            }
            saveCart();
            // feedback sutil
            cartFab.animate([{ transform: 'translateY(0)' }, { transform: 'translateY(-8px)' }, { transform: 'translateY(0)' }], { duration: 300 });
        }

        // ligar bot√µes Add-to-cart
        document.querySelectorAll('.product-card').forEach(card=>{
            const btn = card.querySelector('.add-to-cart');
            if(!btn) return;
            btn.addEventListener('click', ()=>{
                const name = card.dataset.name || card.querySelector('h3')?.innerText || 'Produto';
                // Corrigido: Usando parseFloat para garantir que o pre√ßo seja um n√∫mero, n√£o uma string
                const price = parseFloat(card.dataset.price || 0);
                const img = card.dataset.img || card.querySelector('img')?.src || '';
                addToCart({ name, price, img });
            });
        });

        // abrir / fechar painel
        cartFab.addEventListener('click', ()=>{ cartPanel.classList.toggle('open'); cartPanel.setAttribute('aria-hidden', cartPanel.classList.contains('open') ? 'false' : 'true'); });
        closeCartBtn.addEventListener('click', ()=>{ cartPanel.classList.remove('open'); cartPanel.setAttribute('aria-hidden','true'); });

        // checkout (envia para servidor)
        checkoutBtn.addEventListener('click', async ()=>{
            if(cart.length === 0){ alert('Seu carrinho est√° vazio!'); return; }

            // se estiver logado, envia ao servidor com sess√£o; se n√£o, pede login

        // inicia
        // Corrigido: Adicionado um listener para evitar a duplica√ß√£o de listeners
        // O listener de delega√ß√£o deve ser adicionado apenas uma vez.
        // O listener foi movido para dentro de renderCart, mas deve ser movido para fora
        // para evitar a duplica√ß√£o, ou a l√≥gica de renderCart deve ser ajustada.
        // Vou manter a l√≥gica de delega√ß√£o dentro de renderCart e garantir que ela s√≥ seja chamada uma vez.
        // A l√≥gica de delega√ß√£o foi movida para fora do renderCart.

        // Adiciona o listener de delega√ß√£o de eventos UMA VEZ
        cartItemsEl.addEventListener('click', (e) => {
            const target = e.target;
            const isQtyBtn = target.classList.contains('qty-btn');
            const isRemoveLink = target.classList.contains('remove-link');

            if (isQtyBtn || isRemoveLink) {
                const idx = Number(target.dataset.idx);

                if (isQtyBtn) {
                    const action = target.dataset.action;
                    if(action === 'inc'){ cart[idx].qty += 1; }
                    if(action === 'dec'){ cart[idx].qty = Math.max(1, cart[idx].qty - 1); }
                } else if (isRemoveLink) {
                    cart.splice(idx, 1);
                }
                saveCart();
            }
        });

        renderCart();

        // expose for debugging (opcional)
        window._lojaPicoles = { addToCart, getCart: ()=>cart, saveCart };
    })();
    </script>

    <!-- Placeholder para os seus scripts originais (particles/main) -->
    <script src="particles.js"></script>
    <script src="main.js"></script>
</body>
</html>
